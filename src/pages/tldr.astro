---
import "../styles/global.css";
const title = "TL;DR — stanwood.dev";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta
      name="description"
      content="I don't want to read this long PDF. Tell me what it says."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      body { font-family: 'Inter', system-ui, sans-serif; }

      .drop-zone {
        transition: border-color 0.2s, background-color 0.2s;
      }
      .drop-zone.dragover {
        border-color: #404040;
        background-color: #fafafa;
      }

      .fade-in {
        animation: fadeIn 0.35s ease-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(8px); }
        to   { opacity: 1; transform: translateY(0); }
      }

      .spinner {
        border: 3px solid #e5e5e5;
        border-top: 3px solid #404040;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 0.7s linear infinite;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>
  </head>

  <body class="bg-neutral-50 text-neutral-900 antialiased">
    <main class="mx-auto max-w-2xl px-6 pt-16 pb-24">
      <!-- Top bar -->
      <div class="flex items-center">
        <a
          href="/"
          class="text-sm font-semibold text-neutral-400 hover:text-neutral-900 transition-colors"
        >
          &larr; Home
        </a>
      </div>

      <!-- Header -->
      <header class="mt-10">
        <h1 class="text-4xl font-extrabold tracking-tight text-neutral-900">
          TL;DR
        </h1>
        <p class="mt-3 text-neutral-500 leading-relaxed max-w-lg">
          You got a long PDF and you don't want to read it. Same.
          Drop it here and get the short version — plain language,
          no jargon, just what it actually says.
        </p>
      </header>

      <!-- Upload zone -->
      <section class="mt-10">
        <div
          id="dropZone"
          class="drop-zone relative flex flex-col items-center justify-center rounded-3xl border-2 border-dashed border-neutral-300 bg-white px-8 py-20 text-center cursor-pointer"
        >
          <div id="uploadPrompt">
            <svg class="mx-auto h-10 w-10 text-neutral-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m6.75 12-3-3m0 0-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
            </svg>
            <p class="mt-4 text-sm font-semibold text-neutral-600">
              I don't want to read this long PDF. Tell me what it says.
            </p>
            <p class="mt-1 text-xs text-neutral-400">
              Your file is sent to the AI for summarization, then discarded.
            </p>
          </div>

          <!-- Loading state (hidden by default) -->
          <div id="loadingState" class="hidden">
            <div class="spinner mx-auto"></div>
            <p class="mt-4 text-sm font-semibold text-neutral-600">
              Reading your PDF...
            </p>
            <p id="fileName" class="mt-1 text-xs text-neutral-400"></p>
          </div>

          <input
            id="fileInput"
            type="file"
            accept="application/pdf"
            class="absolute inset-0 h-full w-full cursor-pointer opacity-0"
          />
        </div>
      </section>

      <!-- Result -->
      <section id="resultSection" class="mt-8 hidden">
        <div class="fade-in rounded-3xl border border-neutral-200 bg-white shadow-sm">
          <div class="px-8 py-8">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xs font-semibold uppercase tracking-wide text-neutral-400">
                Summary
              </h2>
              <button
                id="copyBtn"
                class="rounded-lg px-3 py-1.5 text-xs font-semibold text-neutral-500 hover:bg-neutral-100 transition-colors"
              >
                Copy
              </button>
            </div>
            <p id="summaryText" class="text-base leading-relaxed text-neutral-800"></p>
          </div>
        </div>

        <div class="mt-4 text-center">
          <button
            id="resetBtn"
            class="rounded-xl px-5 py-2.5 text-sm font-semibold text-neutral-500 hover:bg-neutral-100 transition-colors"
          >
            Summarize another PDF
          </button>
        </div>
      </section>

      <!-- Error -->
      <div id="errorMsg" class="mt-6 hidden">
        <p class="text-sm text-red-500 text-center"></p>
      </div>
    </main>

    <script>
      const dropZone = document.getElementById("dropZone")!;
      const fileInput = document.getElementById("fileInput") as HTMLInputElement;
      const uploadPrompt = document.getElementById("uploadPrompt")!;
      const loadingState = document.getElementById("loadingState")!;
      const fileNameEl = document.getElementById("fileName")!;
      const resultSection = document.getElementById("resultSection")!;
      const summaryText = document.getElementById("summaryText")!;
      const copyBtn = document.getElementById("copyBtn")!;
      const resetBtn = document.getElementById("resetBtn")!;
      const errorMsg = document.getElementById("errorMsg")!;

      function showError(msg: string) {
        errorMsg.querySelector("p")!.textContent = msg;
        errorMsg.classList.remove("hidden");
      }

      function clearError() {
        errorMsg.classList.add("hidden");
      }

      function setLoading(loading: boolean, name = "") {
        if (loading) {
          uploadPrompt.classList.add("hidden");
          loadingState.classList.remove("hidden");
          fileNameEl.textContent = name;
          fileInput.disabled = true;
          resultSection.classList.add("hidden");
        } else {
          uploadPrompt.classList.remove("hidden");
          loadingState.classList.add("hidden");
          fileInput.disabled = false;
        }
      }

      async function handleFile(file: File) {
        clearError();

        if (file.type !== "application/pdf") {
          showError("That doesn't look like a PDF. Please try a .pdf file.");
          return;
        }

        if (file.size > 25 * 1024 * 1024) {
          showError("That file is too large (max 25 MB).");
          return;
        }

        setLoading(true, file.name);

        try {
          const form = new FormData();
          form.append("pdf", file);

          const res = await fetch("/api/summarize-pdf", {
            method: "POST",
            body: form,
          });

          const data = await res.json();

          if (!res.ok) {
            throw new Error(data.error || "Something went wrong");
          }

          setLoading(false);
          resultSection.classList.remove("hidden");
          // Re-trigger animation
          const card = resultSection.querySelector(".fade-in")!;
          card.classList.remove("fade-in");
          void (card as HTMLElement).offsetWidth;
          card.classList.add("fade-in");
          summaryText.textContent = data.summary;
        } catch (e: any) {
          setLoading(false);
          showError(e.message || "Failed to summarize. Please try again.");
        }
      }

      // Drag & drop
      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("dragover");
      });

      dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("dragover");
      });

      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("dragover");
        const file = e.dataTransfer?.files[0];
        if (file) handleFile(file);
      });

      // File input
      fileInput.addEventListener("change", () => {
        const file = fileInput.files?.[0];
        if (file) handleFile(file);
        fileInput.value = "";
      });

      // Copy
      copyBtn.addEventListener("click", async () => {
        const text = summaryText.textContent || "";
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = "Copied!";
        setTimeout(() => (copyBtn.textContent = "Copy"), 1500);
      });

      // Reset
      resetBtn.addEventListener("click", () => {
        resultSection.classList.add("hidden");
        clearError();
      });
    </script>
  </body>
</html>
